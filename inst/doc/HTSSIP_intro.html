<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Nick Youngblut" />

<meta name="date" content="2016-08-15" />

<title>HTSSIP introduction</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">HTSSIP introduction</h1>
<h4 class="author"><em>Nick Youngblut</em></h4>
<h4 class="date"><em>2016-08-15</em></h4>



<p><strong>HTSSIP</strong> is a package for analyzing high throughput sequence (HTS) data from DNA- or RNA-based stable isotope probing (SIP) experiments.</p>
<p>I recommend starting with this introductory vignette, then checking out the other vignettes:</p>
<ul>
<li><strong>Dataset exploration</strong>
<ul>
<li><a href="beta_diversity_ordinations.html">Beta diversity ordinations of gradient fraction communities</a></li>
<li><a href="BD_shifts.html">Whole-community BD shift plots</a></li>
</ul></li>
<li><strong>Detecting incorporators</strong>
<ul>
<li><a href="MW_HR_SIP.html">HR-SIP &amp; MW-HR-SIP</a></li>
<li><a href="qSIP.html">q-SIP</a></li>
</ul></li>
<li><strong>Calculating amount of incorporation</strong>
<ul>
<li><a href="delta_BD.html">delta-BD</a></li>
<li><a href="qSIP.html">q-SIP</a></li>
</ul></li>
</ul>
<div id="hts-sip-introduction" class="section level1">
<h1>HTS-SIP introduction</h1>
<p>The goal of HTS-SIP methods is to accurately determine which taxa (e.g., bacterial 16S rRNA OTUs) have incorporated isotopically labed substrate into biomass. By correctly identifying these ‘incorporators’, a number of fundamental questions about microbial ecology can be investigated, such as:</p>
<ul>
<li><strong>the microbial food web</strong>
<ul>
<li>e.g., Which bacteria contribute to each step of biomass breakdown in soil?</li>
</ul></li>
<li><strong>the prevalence of functional redundancy and community stability (resilience and resistance)</strong>
<ul>
<li>e.g., Do many microbes consume the same substrates? How can this affect stability of the microbial community and the ecosystem processes mediated by members of the community?</li>
</ul></li>
<li><strong>taxonomic conservatism of ecological roles</strong>
<ul>
<li>e.g., Are closely related microbes usually performing the same functions in the community?</li>
<li>e.g., Do OTU groupings accurately delimit functionally coherent individuals?</li>
</ul></li>
<li><strong>competition and mutualism </strong>
<ul>
<li>e.g., Which microbes will (or will not) stabily coexist in a particular environment?</li>
</ul></li>
<li><strong>how microbial physiology can dictate biogeographic patterns</strong>
<ul>
<li>e.g., Is the biogeography distribution of cellulose specialists more patchy than carbon source generalists?</li>
</ul></li>
</ul>
<div id="background" class="section level2">
<h2>Background</h2>
<p>Note: I’m going to just refer to DNA-SIP, but most of this also applies to RNA-SIP.</p>
<div id="stable-isotope-proving" class="section level3">
<h3>Stable Isotope Proving</h3>
<p>In theory, if a taxon incorporates isotopically labeled substrate, then its DNA with be ‘heavier’ than that if that same taxon had instead incorporated unlabeled substrate. By ‘heavier’, I mean that the DNA with have a higher buoyant density (BD) in a CsCl gradient. So, if you were to load isotopically labeled DNA into one CsCl gradient and unlabeled DNA (from the same taxon) in another CsCl gradient, then the labeled DNA with appear shifted to a heavier BD than the unlabeled DNA. The DNA should be more or less normally distributed in each gradient, so picture a Gaussian distribution that shifts from a ‘light’ BD to a ‘heavy’ BD between the control and treatment gradients. This is the basics of stable isotope probing, which is a powerful method because it can be used to detect which taxa <em>in an entire community</em> consumed particular substrates (e.g., cellulose).</p>
<p>For example, a basic SIP experiment could consist of incubating aliquots of soil with either 13C-glucose (treatment) or 12C-glucose (the corresponding control). The DNA is then extracted from each soil sample, and heavy DNA is separated (at least partially) from light DNA using CsCl gradient ultra centrifugation. Now, the challenge is to accurately determine the location of each taxon’s DNA in each of the 2 gradients in order to identify which taxa ‘shifted’ in the labeled treatment gradient due to isotope incorporation. Prior to the rise of high throughput sequencing (HTS) methods, this task was very difficult due to the limited throughput and taxonomic resolution of molecular fingerprinting and Sanger sequencing.</p>
</div>
<div id="hts-sip" class="section level3">
<h3>HTS-SIP</h3>
<p>With high throughput sequencing, the taxonomic composition can be assessed at many points along a CsCl gradient by fractionating the gradient and sequencing the DNA in each fraction (note: I’m just going to focus on 16S rRNA sequencing, but fungal-ITS or metagenomic sequencing are also effective HTS-SIP methods). A large number of gradient fractions can be sequenced, which can help pinpoint the exact BD density range that each OTU occupies. For a typical HR-SIP experiment, ~20-30 fractions from each gradient are often sequenced.</p>
<p>Now remember, we are trying to use HTS-SIP to identify ‘BD shifts’, which indicate isotope incorporation. This is done by comparing labeled-treatment gradients to their corresponding unlabeled control gradients. Optimally, we’d be able to measure the <em>absolute</em> abundance of each taxon’s OTU in each gradient fraction in order to get an idea where the Gaussian distribution of that OTU’s DNA is in the gradient.</p>
<p>The problem is that HTS data is compositional, in that the total number of sequences in a sample does not provide any information on the total numbers of each taxon in the sample. This is why relative abundances of OTUs are shown in at least most microbiome papers, such as the relative abundance bar plots in A LOT of microbiome papers. Therefore, we have to try to determine the absolute abundance Gaussian distributions of each OTU in each gradient based on compositional 16S rRNA sequence data. Various HTS-SIP data analysis methods have be developed to address this challenge (e.g., HR-SIP and q-SIP). This R package was developed to easily implement on your own data, so that you can compare the results (and possible develop new methods).</p>
<p>For more information on SIP and HTS-SIP, check out these references:</p>
<ul>
<li><strong>DNA SIP</strong>
<ul>
<li>Neufeld, Josh D., Jyotsna Vohra, Marc G. Dumont, Tillmann Lueders, Mike Manefield, Michael W. Friedrich, and J. Colin Murrell. 2007. “DNA Stable-Isotope Probing.” Nature Protocols 2 (4): 860–66.</li>
<li>Buckley, Daniel H., Varisa Huangyutitham, Shi-Fang Hsu, and Tyrrell A. Nelson. 2007. “Stable Isotope Probing with 15N Achieved by Disentangling the Effects of Genome G+C Content and Isotope Enrichment on DNA Density.” Applied and Environmental Microbiology 73 (10): 3189–95.</li>
<li>Youngblut, Nicholas D., and Daniel H. Buckley. 2014. “Intra-Genomic Variation in G + C Content and Its Implications for DNA Stable Isotope Probing.” Environmental Microbiology Reports 6 (6): 767–75.</li>
</ul></li>
<li><strong>HR-SIP</strong>
<ul>
<li>Pepe-Ranney, Charles, Chantal Koechli, Ruth Potrafka, Cheryl Andam, Erin Eggleston, Ferran Garcia-Pichel, and Daniel H. Buckley. 2015. “Non-Cyanobacterial Diazotrophs Mediate Dinitrogen Fixation in Biological Soil Crusts during Early Crust Formation.” The ISME Journal, June. <a href="doi:10.1038/ismej.2015.106" class="uri">doi:10.1038/ismej.2015.106</a>.</li>
<li>Pepe-Ranney, Charles, Ashley N. Campbell, Chantal N. Koechli, Sean Berthrong, and Daniel H. Buckley. 2016. “Unearthing the Ecology of Soil Microorganisms Using a High Resolution DNA-SIP Approach to Explore Cellulose and Xylose Metabolism in Soil.” Terrestrial Microbiology, 703.</li>
</ul></li>
<li><strong>qSIP</strong>
<ul>
<li>Hungate, Bruce A., Rebecca L. Mau, Egbert Schwartz, J. Gregory Caporaso, Paul Dijkstra, Natasja van Gestel, Benjamin J. Koch, et al. 2015. “Quantitative Microbial Ecology Through Stable Isotope Probing.” Applied and Environmental Microbiology, August, AEM.02280–15.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="htssip-package-data" class="section level1">
<h1>HTSSIP package data</h1>
<p>The <code>phyloseq</code> R package provides some great functions for importing and analyzing microbiome data in R. So instead of reinventing the wheel, HTSSIP utilizes Phyloseq objects as input. See the <a href="https://github.com/joey711/phyloseq">GitHub page</a> or the <a href="http://joey711.github.io/phyloseq/">package website</a> for more info about the phyloseq.</p>
<p>The basic HTS-SIP dataset in the <code>HTSSIP</code> package consists of three CsCl 3 gradients, each with ~24 samples (gradient fractions). There are 2 treatment gradients, which contained DNA extracted from microcosms recieving both cellulose and glucose, but only one substrate was 13C-labeled for each treatment. For example, the 13C-cellulose (13C-Cel) treatment recieved 13C-cellulose and 12C-glucose. This experimental design had the benefit of requiring only one 12C-control that recieved 12C-cellulose and 12C-glucose.</p>
<p>First, let’s load some packages including <code>HTSSIP</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="co">#library(ggplot2)</span>
<span class="kw">library</span>(HTSSIP)</code></pre></div>
<p>Now, let’s check out the HTSSIP phyloseq object that we will be using in the other vignettes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">physeq_S2D2</code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 139 samples ]
## sample_data() Sample Data:       [ 139 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]</code></pre>
<div id="experiment-overview" class="section level3">
<h3>Experiment overview</h3>
<p>The dataset if from a larger SIP experiment in which labeled substrates were incubated with 15 g of soil in microcosms. The microcosms were destructively sampled at certain numbers of days from the initial substrate addition. The DNA was extracted and loaded into CsCl gradients. Importantly, each microcosm recieved the same amount of all substrates used in the experiment, but only one of the substrates was 13C labeled for each labeled treatment, while the unlabeled controls recieved the same substrates (all 12C unlabeled versions). This design allowed for only one 12C control microcosm per time point (instead of 1 control per labeled substrate). Approximately 24 gradient fractions from each gradient were sequenced with MiSeq 16S rRNA sequencing.</p>
<p>The dataset subset that we’ll be using consists of samples 6 CsCl gradients:</p>
<ol style="list-style-type: decimal">
<li>12C-Con, Day 3</li>
<li>13C-Glu, Day 3</li>
<li>13C-Cel, Day 3</li>
<li>12C-Con, Day 14</li>
<li>13C-Glu, Day 14</li>
<li>13C-Cel, Day 14</li>
</ol>
<ul>
<li>“12C-Con” stands for the unlabeled control,</li>
<li>“13C-Glu” and “13C-Cel” stand for 13C-gluclose and 13C-cellulose, respectively</li>
<li>“Day” is the number of days from substrate addition.</li>
</ul>
</div>
<div id="sample-metadata" class="section level3">
<h3>Sample metadata</h3>
<p>Here’s a look at (some) of the sample metadata. Note that <code>Bouyant_density</code> is one of the columns. This is necessary for many of the analyses in <code>HTSSIP}</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">physeq_S2D2 %&gt;%<span class="st"> </span>sample_data %&gt;%<span class="st"> </span>.[<span class="dv">1</span>:<span class="dv">4</span>,<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>## Sample Data:        [4 samples by 10 sample variables]:
##                              X.Sample primer_number fwd_barcode
## 12C-Con.D14.R1_F17 12C-Con.D14.R1_F17            38    CGTGAGTG
## 13C-Cel.D3.R1_F21   13C-Cel.D3.R1_F21             7    GGATATCT
## 13C-Cel.D3.R1_F20   13C-Cel.D3.R1_F20             6    CGTGAGTG
## 13C-Cel.D14.R1_F12 13C-Cel.D14.R1_F12            57    ATCGTACG
##                    rev_barcode Substrate Day Microcosm_replicate Fraction
## 12C-Con.D14.R1_F17    TGAGTACG   12C-Con  14                   1       17
## 13C-Cel.D3.R1_F21     CGAGAGTT   13C-Cel   3                   1       21
## 13C-Cel.D3.R1_F20     CGAGAGTT   13C-Cel   3                   1       20
## 13C-Cel.D14.R1_F12    CGAGCGAC   13C-Cel  14                   1       12
##                    Buoyant_density Sample_type
## 12C-Con.D14.R1_F17        1.715475     unknown
## 13C-Cel.D3.R1_F21         1.705640     unknown
## 13C-Cel.D3.R1_F20         1.706186     unknown
## 13C-Cel.D14.R1_F12        1.735145     unknown</code></pre>
<p>To check the formatting of the phyloseq object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Our phyloseq object should be formatted correctly (no errors)</span>
physeq_S2D2 =<span class="st"> </span><span class="kw">physeq_format</span>(physeq_S2D2)
physeq_S2D2 %&gt;%<span class="st"> </span>sample_data %&gt;%<span class="st"> </span>.[<span class="dv">1</span>:<span class="dv">4</span>,<span class="dv">1</span>:<span class="dv">10</span>]</code></pre></div>
<pre><code>## Sample Data:        [4 samples by 10 sample variables]:
##                              X.Sample primer_number fwd_barcode
## 12C-Con.D14.R1_F17 12C-Con.D14.R1_F17            38    CGTGAGTG
## 13C-Cel.D3.R1_F21   13C-Cel.D3.R1_F21             7    GGATATCT
## 13C-Cel.D3.R1_F20   13C-Cel.D3.R1_F20             6    CGTGAGTG
## 13C-Cel.D14.R1_F12 13C-Cel.D14.R1_F12            57    ATCGTACG
##                    rev_barcode Substrate Day Microcosm_replicate Fraction
## 12C-Con.D14.R1_F17    TGAGTACG   12C-Con  14                   1       17
## 13C-Cel.D3.R1_F21     CGAGAGTT   13C-Cel   3                   1       21
## 13C-Cel.D3.R1_F20     CGAGAGTT   13C-Cel   3                   1       20
## 13C-Cel.D14.R1_F12    CGAGCGAC   13C-Cel  14                   1       12
##                    Buoyant_density Sample_type
## 12C-Con.D14.R1_F17        1.715475     unknown
## 13C-Cel.D3.R1_F21         1.705640     unknown
## 13C-Cel.D3.R1_F20         1.706186     unknown
## 13C-Cel.D14.R1_F12        1.735145     unknown</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This phyloseq object should NOT be formatted correctly </span>
<span class="kw">library</span>(phyloseq)
<span class="kw">data</span>(GlobalPatterns)
GlobalPatterns %&gt;%<span class="st"> </span>sample_data %&gt;%<span class="st"> </span>.[<span class="dv">1</span>:<span class="dv">4</span>,<span class="dv">1</span>:<span class="kw">ncol</span>(.)]</code></pre></div>
<pre><code>## Sample Data:        [4 samples by 7 sample variables]:
##         X.SampleID  Primer Final_Barcode Barcode_truncated_plus_T
## CL3            CL3 ILBC_01        AACGCA                   TGCGTT
## CC1            CC1 ILBC_02        AACTCG                   CGAGTT
## SV1            SV1 ILBC_03        AACTGT                   ACAGTT
## M31Fcsw    M31Fcsw ILBC_04        AAGAGA                   TCTCTT
##         Barcode_full_length SampleType
## CL3             CTAGCGTGCGT       Soil
## CC1             CATCGACGAGT       Soil
## SV1             GTACGCACAGT       Soil
## M31Fcsw         TCGACATCTCT      Feces
##                                        Description
## CL3       Calhoun South Carolina Pine soil, pH 4.9
## CC1       Cedar Creek Minnesota, grassland, pH 6.1
## SV1     Sevilleta new Mexico, desert scrub, pH 8.3
## M31Fcsw    M3, Day 1, fecal swab, whole body study</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tryCatch</span>(
  <span class="kw">physeq_format</span>(GlobalPatterns),
  <span class="dt">error =</span> function(e) e
  )</code></pre></div>
<pre><code>## &lt;simpleError in physeq_format(GlobalPatterns): No &quot;Buoyant_density&quot; column found in metadata&gt;</code></pre>
</div>
<div id="parsing-the-dataset" class="section level2">
<h2>Parsing the dataset</h2>
<p>For most of the analyses in <code>HTSSIP</code>, the gradient fraction samples of each labeled-treatment gradient is compared to its corresponding control. For example, the dataset that we’ve been looking at has 4 comparisons:</p>
<ol style="list-style-type: decimal">
<li>12C-Con_Day3 vs 13C-Glu_Day3</li>
<li>12C-Con_Day3 vs 13C-Cel_Day3</li>
<li>12C-Con_Day14 vs 13C-Glu_Day14</li>
<li>12C-Con_Day14 vs 13C-Cel_Day14</li>
</ol>
<p>Note that the same 12C-control is used for both because both treatments recieved both glucose &amp; cellulose, but only 1 substrate was isotopically labeled.</p>
<p>So to subset the data with phyloseq, we can use the <code>prune_samples()</code> function to subset the dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw">sample_data</span>(physeq_S2D2)

physeq_13C.Glu_D3 =<span class="st"> </span><span class="kw">prune_samples</span>((m$Substrate==<span class="st">'12C-Con'</span> &amp;<span class="st"> </span>m$Day==<span class="dv">3</span>) |<span class="st"> </span>(m$Substrate==<span class="st">'13C-Glu'</span> &amp;<span class="st"> </span>m$Day==<span class="dv">3</span>), physeq_S2D2)
physeq_13C.Glu_D3</code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 46 samples ]
## sample_data() Sample Data:       [ 46 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">physeq_13C.Cel_D14 =<span class="st"> </span><span class="kw">prune_samples</span>((m$Substrate==<span class="st">'12C-Con'</span> &amp;<span class="st"> </span>m$Day==<span class="dv">3</span>) |<span class="st"> </span>(m$Substrate==<span class="st">'13C-Cel'</span> &amp;<span class="st"> </span>m$Day==<span class="dv">14</span>), physeq_S2D2)
physeq_13C.Cel_D14</code></pre></div>
<pre><code>## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 46 samples ]
## sample_data() Sample Data:       [ 46 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]</code></pre>
<p>Writing a bunch of redundant code to make each subset is not a good method to subset the data if you have a bunch of subsets to make, so <code>HTSSIP</code> includes some functions to help.</p>
<p>The expression used in the <code>prune_samples()</code> to subset the data can be generalized as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex =<span class="st"> &quot;(Substrate=='12C-Con' &amp; Day=='${Day}') | (Substrate=='${Substrate}' &amp; Day == '${Day}')&quot;</span></code></pre></div>
<p>Now we need the parameters for each individual <code>prune_samples()</code> call. Then, we can iteratively insert these parameters into the expression in order create all of the subsets. This can be accomplished with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">params =<span class="st"> </span><span class="kw">get_treatment_params</span>(physeq_S2D2, <span class="kw">c</span>(<span class="st">'Substrate'</span>, <span class="st">'Day'</span>), <span class="st">&quot;Substrate != '12C-Con'&quot;</span>)
params</code></pre></div>
<pre><code>##   Substrate Day
## 1   13C-Cel   3
## 2   13C-Cel  14
## 3   13C-Glu  14
## 4   13C-Glu   3</code></pre>
<p>Let’s use the expression and parameters to subset the phyloseq object into a list of phyloseq object subsets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">physeq_S2D2_l =<span class="st"> </span><span class="kw">phyloseq_subset</span>(physeq_S2D2, params, ex)
physeq_S2D2_l</code></pre></div>
<pre><code>## $`(Substrate=='12C-Con' &amp; Day=='3') | (Substrate=='13C-Cel' &amp; Day == '3')`
## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 46 samples ]
## sample_data() Sample Data:       [ 46 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]
## 
## $`(Substrate=='12C-Con' &amp; Day=='14') | (Substrate=='13C-Cel' &amp; Day == '14')`
## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 46 samples ]
## sample_data() Sample Data:       [ 46 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]
## 
## $`(Substrate=='12C-Con' &amp; Day=='14') | (Substrate=='13C-Glu' &amp; Day == '14')`
## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 47 samples ]
## sample_data() Sample Data:       [ 47 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]
## 
## $`(Substrate=='12C-Con' &amp; Day=='3') | (Substrate=='13C-Glu' &amp; Day == '3')`
## phyloseq-class experiment-level object
## otu_table()   OTU Table:         [ 10001 taxa and 46 samples ]
## sample_data() Sample Data:       [ 46 samples by 17 sample variables ]
## tax_table()   Taxonomy Table:    [ 10001 taxa by 8 taxonomic ranks ]
## phy_tree()    Phylogenetic Tree: [ 10001 tips and 10000 internal nodes ]</code></pre>
<p>With a list of phyloseq objects (1 list item per treatment-control comparison), we can use <code>lapply()</code> or a similar function to run analyses on each subset of the dataset.</p>
</div>
</div>
<div id="references-for-methods-in-htssip" class="section level1">
<h1>References for methods in HTSSIP</h1>
<ul>
<li><strong>HTS-SIP data exploration</strong>
<ul>
<li>Multiple window High Resolution Stable Isotope Probing (MW-HR-SIP) as described in Youngblut and Buckley <em>in review</em></li>
</ul></li>
<li><strong>HR-SIP</strong>
<ul>
<li>High Resolution Stable Isotope Probing (HR-SIP) as described in <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC4867679/">Pepe-Ranney et al., 2016</a></li>
</ul></li>
<li><strong>MW-HR-SIP</strong>
<ul>
<li>Multiple window High Resolution Stable Isotope Probing (MW-HR-SIP) as described in Youngblut and Buckley <em>in review</em></li>
</ul></li>
<li><strong>qSIP</strong>
<ul>
<li>Quantitative stable isotope probing (q-SIP) as described in <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC4592864/">Hungate et al., 2015</a></li>
</ul></li>
</ul>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.2.4 Revised (2016-03-16 r70336)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu precise (12.04.5 LTS)
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] tidyr_0.5.1     HTSSIP_0.1.0    ggplot2_2.1.0   dplyr_0.5.0    
## [5] phyloseq_1.14.0
## 
## loaded via a namespace (and not attached):
##  [1] Biobase_2.30.0             splines_3.2.4             
##  [3] foreach_1.4.3              Formula_1.2-1             
##  [5] assertthat_0.1             stats4_3.2.4              
##  [7] latticeExtra_0.6-28        yaml_2.1.13               
##  [9] RSQLite_1.0.0              lattice_0.20-33           
## [11] uuid_0.1-2                 digest_0.6.9              
## [13] chron_2.3-47               GenomicRanges_1.22.4      
## [15] RColorBrewer_1.1-2         XVector_0.10.0            
## [17] colorspace_1.2-6           htmltools_0.3.5           
## [19] Matrix_1.2-6               plyr_1.8.4                
## [21] devtools_1.12.0            DESeq2_1.10.1             
## [23] XML_3.98-1.4               genefilter_1.52.1         
## [25] zlibbioc_1.16.0            xtable_1.8-2              
## [27] scales_0.4.0               BiocParallel_1.4.3        
## [29] tibble_1.1                 annotate_1.48.0           
## [31] mgcv_1.8-12                IRanges_2.4.8             
## [33] withr_1.0.2                SummarizedExperiment_1.0.2
## [35] nnet_7.3-12                BiocGenerics_0.16.1       
## [37] lazyeval_0.2.0             crayon_1.3.2              
## [39] survival_2.39-5            RJSONIO_1.3-0             
## [41] magrittr_1.5               memoise_1.0.0             
## [43] evaluate_0.9               doParallel_1.0.10         
## [45] nlme_3.1-128               MASS_7.3-45               
## [47] RcppArmadillo_0.7.100.3.1  foreign_0.8-66            
## [49] vegan_2.4-0                tools_3.2.4               
## [51] data.table_1.9.6           formatR_1.4               
## [53] stringr_1.0.0              S4Vectors_0.8.11          
## [55] munsell_0.4.3              locfit_1.5-9.1            
## [57] cluster_2.0.4              AnnotationDbi_1.32.3      
## [59] lambda.r_1.1.7             Biostrings_2.38.4         
## [61] ade4_1.7-4                 compiler_3.2.4            
## [63] GenomeInfoDb_1.6.3         futile.logger_1.4.1       
## [65] grid_3.2.4                 iterators_1.0.8           
## [67] biom_0.3.12                igraph_1.0.1              
## [69] rmarkdown_1.0              labeling_0.3              
## [71] testthat_1.0.2             gtable_0.2.0              
## [73] codetools_0.2-14           multtest_2.26.0           
## [75] roxygen2_5.0.1             DBI_0.4-1                 
## [77] reshape2_1.4.1             R6_2.1.2                  
## [79] gridExtra_2.2.1            knitr_1.13                
## [81] Hmisc_3.17-4               futile.options_1.0.0      
## [83] permute_0.9-0              ape_3.5                   
## [85] stringi_1.1.1              parallel_3.2.4            
## [87] Rcpp_0.12.5                geneplotter_1.48.0        
## [89] rpart_4.1-10               acepack_1.3-3.3</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
